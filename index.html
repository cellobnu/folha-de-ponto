<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
  		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		
  		<title>Bate-Ponto</title>
        
        <link rel="apple-touch-icon" href="imagens/icon_57x57.png"/>
  		<link rel="apple-touch-startup-image" href="imagens/startup.jpg" />
        <link rel="stylesheet" href="./css/jquery.mobile-1.3.2.min.css" />
        <link rel="stylesheet" href="./theme-bate-ponto/bate-ponto.min.css" />
        
        <script src="./js/jquery-1.10.2.min.js"></script>
        <script src="./js/jquery.mobile-1.3.2.min.js"></script>
        
        <script>
			$.mobile.loadingMessage  = "Carregando";

            $(document).ready(function(){
                try{
                    if(!window.openDatabase){
                        alert('not supported');
                    } else {
                        var database = "ponto";
                        var version = "1.0";
                        var displayName = "ponto";
                        var maxSize = 2 * 1024 *1024;
                
                        var db = openDatabase(database,version,displayName,maxSize);
                    }
                } catch(e){
                    if(e == 2){
                        alert("Invalid database version");
                    } else {
                        alert("Unknown error "+e+".");
                    }
                    return;
                }
                                
                
                $('#bater').on("click",function(){
                    var periodo = $('#periodo').val();
                    var date = new Date();
                    var currentDate = date.getFullYear()+"/"+(date.getMonth()+1)+"/"+date.getDate();
                    var currentTime = date.getHours()+":"+date.getMinutes();
                    
                    db.transaction(function(transaction){
                        transaction.executeSql('CREATE TABLE IF NOT EXISTS ponto (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, data text, entrada text NOT NULL, almoco text, retorno DATE, saida text);');
                        if(periodo==="entrada"){
                            console.log("entrada");
                            transaction.executeSql(
                                "INSERT INTO ponto ('data','entrada') VALUES ('"+currentDate+"','"+currentTime+"');"
                            );
                        }else{
                            console.log("UPDATE ponto SET '"+periodo+"'='"+currentTime+"' WHERE data = '"+currentDate+"';")
                            transaction.executeSql(
                                "UPDATE ponto SET '"+periodo+"'='"+currentTime+"' WHERE data = '"+currentDate+"';"
                            );
                        }
                    });
                    
                    console.log(periodo);
                    location.href="folha-de-ponto.html";
                });
            });
            
        </script>
    </head>
    <body>
        <div data-role="page" id="home">
            <header data-role="header" data-position="fixed">
                <h1>Bate-Ponto</h1>
            </header>
            <section data-role="content">
                    <div data-role="fieldcontain">
                        <label for="periodo" class="ui-hidden-accessible">Escolher</label>
                        <select name="periodo" id="periodo" data-native-menu="false">
                            <option value="">Escolha o período</option>
                            <option value="entrada">Entrada</option>
                            <option value="almoco">Almoço</option>
                            <option value="retorno">Retorno</option>
                            <option value="saida">Saída</option>
                        </select>
                        <button id="bater">bater</button>
                    </div>
                
            </section>
            <footer data-role="footer" data-position="fixed">
                <nav data-role="navbar">
                    <ul>
                        <li><a data-role="button" data-transition="slideup" href="index.html" class="ui-btn-active ui-state-persist">Home</a></li>
                        <li><a data-role="button" data-transition="slideup" href="folha-de-ponto.html">Folha de ponto</a></li>
                        <li><a data-role="button" data-transition="slideup" href="configuracoes.html">Configurações</a></li>
                    </ul>
                </nav>
            </footer>
        </div>
    </body>
</html>